<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	
	<title>NYC Pre-K Finder - Get in Touch</title>

	<link rel="stylesheet" href="//code.jquery.com/mobile/1.4.3/jquery.mobile-1.4.3.min.css">
	
	<style type="text/css">
		body, label, span, div{
			color: #013364 !important;
		}
		body.loading{
			background-image:url(https://maps.nyc.gov/upk/img/spin.gif);
			background-position:center;
			background-repeat:no-repeat;
		}
		.loading div, .loading span, .loading h1, .loading h2, .loading h3, .loading input, .loading select{
			visibility:hidden;
		}
		label{
			white-space: nowrap;
			padding-right: 10px;
		}
		h2, h3{
			color: #5681ac;
		}
		form {
			margin: 0 auto 100px;
			max-width: 600px;
		}
		.sect{
			border:1px solid #5681ac;
			border-radius:0.6em;
			padding:5px;
			margin:0 0 10px 0;
		}
		.ui-selectmenu-button{
			width:100% !important;
		}
		.ui-btn:after{
			background-color: rgba(1,51,100,0.5);
		}
		.ui-btn:hover:after{
			background-color: rgb(1,51,100);
		}
		.err{
			color:red !important;
			font-weight:bold !important;
		}
		#review, #result{
			position: fixed;
			margin: 12px calc(50% - 135px);
			width: 270px;
			border-radius: 0.6em;
			border: 1px solid lightgrey;
			box-shadow: 5px 10px 20px 5px rgba(1,51,100,0.9);
			background-color: white;
			padding: 5px;
			display:none;
		}
		.ui-btn.ui-corner-all, .ui-corner-all{
			border-radius: 0.6em;
		}
		#review h3{
			text-align:center;
		}
		.name{
			font-weight:bold;
		}
		#reviewBtns{
			width:207px;
			margin:20px 29px;
		}
		#thanks{
			padding: 5px;
		}
		#req_note{
			text-align: center;
		}
		table.fields{
			width: 100%;
			border-collapse: collapse;
		}
		.fields td{
			vertical-align: top;
			width: 50%;
		}
		#house_cell{
			width: 30px;
		}
		#street_cell{
			width: 300px;
		}
		#apt_cell{
			width: 30px;
		}
		#borough_cell{
			width: 70%;
		}
		#zip_cell{
			width: 30%;
		}
		@media only screen and (max-width : 600px) {
			#street_cell{
				width: auto;
			}
		}
		@media only screen and (max-width : 360px) {
			#house_cell{
				width: 60px;
			}
			#apt_cell{
				width: 30px;
			}		
		}
	</style>
	
	<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="//code.jquery.com/mobile/1.4.3/jquery.mobile-1.4.3.min.js"></script>
	<script src="date_rules.js"></script>
	
	<script>
		
		/* 
		 * Set all global date strings and date-like strings from date_rules.js
		 * Replace invalid date rules with defauls
		 * date_rules.js is maintained by DOE
		 */
		(function(){
			
			window.MONTHS = ["January", "February", "March", "April", "May", "June", "July",
			                 "August", "September", "October", "November", "December"];
			
			var pad = function(number){
				return number < 10 ? "0" + number : number + "";
			};
			
			var DEFAULT_DATES = {
				TODAY: new Date(),
				MIN_DOB: "2010-01-01",
				MAX_DOB: (function(){
					var today = new Date();
					return today.getUTCFullYear() + "-" +
						pad(today.getUTCMonth() + 1) + "-" +
						pad(today.getUTCDate());
				}()),
				DEFAULT_DOB_ENTRY: "2011-01-01",
				PRE_K_REQUIRED_DOB_YEAR: "2011",
				SCHOOL_YEAR: "2015-16",
				APPLY_START_DATE: "2015-03-16",
				APPLY_END_DATE: "2015-04-25"
			};
							
			var validDateString = function(dateVarName){
				var invalidDateProvided = true;
				if (window[dateVarName]){
					try{
						var dateTyr = new Date(window[dateVarName]);
						invalidDateProvided = !isNaN(dateTyr.getFullYear());
					}catch(ignore){
						invalidDateProvided = true;
					}
				}
				return invalidDateProvided ? DEFAULT_DATES[dateVarName] : window[dateVarName];
			};

			window.TODAY = DEFAULT_DATES.TODAY;
			window.MIN_DOB = validDateString("MIN_DOB");
			window.MAX_DOB = validDateString("MAX_DOB");
			window.DEFAULT_DOB_ENTRY = validDateString("DEFAULT_DOB_ENTRY");
			window.PRE_K_REQUIRED_DOB_YEAR = window.PRE_K_REQUIRED_DOB_YEAR || DEFAULT_DATES.PRE_K_REQUIRED_DOB_YEAR;
			window.SCHOOL_YEAR = window.SCHOOL_YEAR || DEFAULT_DATES.SCHOOL_YEAR;
			window.APPLY_START_DATE = validDateString("APPLY_START_DATE");
			window.APPLY_END_DATE = validDateString("APPLY_END_DATE");

		}());
		
		$("document").ready(function(){		
			$("#applyNow").click(valid);
			$("select").on("change",function(e){$(e.target).focus();});
			$("#school_yr").html(SCHOOL_YEAR);
			$("#birth_yr").html(PRE_K_REQUIRED_DOB_YEAR);
			$("#application-interval").html(getApplicationInterval());
			$("#dob").attr("min", MIN_DOB)
				.attr("max", MAX_DOB)
				.val(DEFAULT_DOB_ENTRY);
		});

		function valid(){
			var err = [];
			$("label, span").removeClass("err");
			$.each($("input, select"), function(_, n){
				if ($(n).prop("required") || $(n).attr("required")){
					var val = $(n).val(), pattern = $(n).attr("pattern") || $(n).data("pattern"), valid = val.length;
					if (n.id == "dob"){
						var dob = new Date(getIsoDob());
						valid = dob >= new Date(MIN_DOB) && dob <= new Date(MAX_DOB);
					}else{
						if (valid && pattern){
							var regex = new RegExp(pattern);
							valid = regex.test(val);
						}						
					}
					if (!valid){
						err.push(n);
						$("label[for='" + n.id + "']").addClass("err");												
					}
				}
			});
			if (err.length){
				$(err[0]).focus();
			}else{
				review();
			}
		};	
	
		function review(){				
			var data = formData();
			for (var d in data){
				$("#review_" + d).html(data[d].toString());
			}
			$("#review").css({visibility: "hidden", display:"block"});
			var bottom = $(window).height() / 2 - $("#review").height() / 2;
			$("#review").css({visibility: "visible", display:"none"});
			$("#review").css("bottom", bottom + "px");
			$("#review").fadeIn(function(){
				$("#result").css("top", $("#review").position().top + "px");
			});
		};
		
		function getApplicationInterval(){
			var start = new Date(APPLY_START_DATE), end = new Date(APPLY_END_DATE);
			end.setDate(end.getDate() - 1);
			return MONTHS[start.getUTCMonth()] + " " +
				start.getUTCDate() + " to " +
				MONTHS[end.getUTCMonth()] + " " +
				end.getUTCDate() + ", " +
				end.getUTCFullYear();
		}
		
		function getDoeDob(dob){
			var dob = dob || $("#dob").val();
			if (dob.indexOf("/") > -1){
				return dob;
			}else{
				dob = dob.split("-");
				return dob[1] + "/" + dob[2] + "/" + dob[0];				
			}
		};
		
		function getIsoDob(){
			var dob = $("#dob").val();
			if (dob.indexOf("-") > -1){
				return dob;
			}else{
				dob = dob.split("/");
				if (dob[0].length == 2 && 
						dob[1].length == 2 && 
						dob[2].length == 4 &&
						(dob[0] * 1) > 0 && (dob[0] * 1) < 13 &&
						(dob[1] * 1) > 0 && (dob[1] * 1) < 32
						){
					return dob[2] + "-" + dob[0] + "-" + dob[1];				
				}
				return "invalid";				
			}
		};
		
		function formData(){
			var result = {};
			result.dob = getDoeDob();
			result.house_number = $("#house_number").val();
			result.street_name = $("#street_name").val();
			result.apt = $("#apt").val();
			result.borough = $("#borough").val();
			result.zip_code = $("#zip_code").val();
			result.parent_first_name = $("#parent_first_name").val();
			result.parent_last_name = $("#parent_last_name").val();
			result.relationship = $("#relationship").val();
			result.day_telephone = $("#day_telephone").val();
			result.evening_telephone = $("#evening_telephone").val();
			result.email = $("#email").val();
			return result;
		};
		
		function apply(){
			var data = {id:0, method:"apply", jsonrpc:"2.0", params:{action:"apply", formfields:formData()}};
			$.ajax({
				url:"./services/SchoolRpc.ashx?rpc",
				beforeSend: function(request){
					request.setRequestHeader("Content-Type", "application/json; charset-utf-8");
				},
				method:"POST",
				dataType:"json",
				data:JSON.stringify(data),
				success: function(response){
					if (!response.result || (!response.result.ApplicationSubmitFlag && !response.result.EmailSentFlag)){
						this.error();
						return;
					}
					$("form")[0].reset();					
					$("#review").fadeOut(function(){
						$("#result").fadeIn();					
					});
				},
				error: function(){
					alert("There was an error processing your submission data.  Please try again.");
					$("#review").fadeOut();
				}
			});
			return false;
		};
	</script>
</head>
<body>
	<div id="page" data-role="page">
		<div id="main" data-role="main" class="ui-content">
			<form autocomplete="on" novalidate>
				<div class="sect">
					<h2>Student Information</h2>
					<label for="dob">Date of birth:</label>
					<input id="dob" name="dob" type="date" required="true" maxlength="10" placeholder="mm/dd/yyyy">
					(<b>Note:</b> To be eligible for pre-K for the <span id="school_yr"></span> school year, your child must have been born in the year <span id="birth_yr"></span>.)
					<h3>Current address</h3>
					<table class="fields">
						<tbody>
							<tr>
								<td id="house_cell">
									<label for="house_number">House no:</label>
									<input id="house_number" name="house_number" type="text" maxlength="10" required="true" placeholder="52">
								</td>
								<td id="street_cell">
									<label for="street_name">Street name:</label>
									<input id="street_name" name="street_name" type="text" required="true" placeholder="Chambers St">
								</td>
								<td id="apt_cell">
									<label for="apt">Apt:</label>
									<input id="apt" name="apt" type="text" placeholder="1A">					
								</td>
							</tr>
						</tbody>
					</table>	
					<table class="fields">
						<tbody>
							<tr>
								<td id="borough_cell">
									<label for="borough">Borough:</label>
									<select id="borough" name="borough" required="true" data-pattern="^((?!Choose).)*$">
										<option>Choose...</option>
										<option>Bronx</option>
										<option>Brooklyn</option>
										<option>Manhattan</option>
										<option>Queens</option>
										<option>Staten Island</option>
									</select>
								</td>
								<td id="zip_cell">		
									<label for="zip_code">ZIP Code:</label>
									<input id="zip_code" name="zip_code" type="text" maxlength="5" required="true" pattern="^\d{5}$" placeholder="12345">
								</td>
							</tr>
						</tbody>
					</table>
				</div>					
				<div class="sect">
					<h2>Parent/Guardian Information</h2>
					<table class="fields">
						<tbody>
							<tr>
								<td>
									<label for="parent_first_name">First name:</label>
									<input id="parent_first_name" name="parent_first_name" type="text" required>
								</td>
								<td>
									<label for="parent_last_name">Last name:</label>
									<input id="parent_last_name" name="parent_last_name" type="text" required>
								</td>
							</tr>
						</tbody>
					</table>
					<label for="relationship">Relationship:</label>
					<select id="relationship" name="relationship" required="true" data-pattern="^((?!Choose).)*$">
						<option>Choose...</option>
						<option>Mother</option>
						<option>Father</option>
						<option>Grandparent</option>
						<option>Sister/Brother</option>
						<option>Other Relative</option>
						<option>Step Parent</option>
						<option>Foster Parent</option>
						<option>Agency</option>
						<option>Ward Of State</option>
						<option>Other Legal Guardian</option>
						<option>Non-Relative</option>
					</select>
					<h3>Contact Information</h3>
					<table class="fields">
						<tbody>
							<tr>
								<td>
									<label for="day_telephone">Day phone:</label>
									<input id="day_telephone" name="day_telephone" type="text" maxlength="10" required="true" pattern="[0-9]{10}" placeholder="2125555555">
								</td>
								<td>	
									<label for="evening_telephone">Evening phone:</label>
									<input id="evening_telephone" name="evening_telephone" maxlength="10" type="text" required="true" pattern="[0-9]{10}" placeholder="2125555555">
								</td>
							</tr>
						</tbody>
					</table>
					<label for="email">Email address:</label>
					<input id="email" name="email" type="text" required="true" pattern="[\w-]+@([\w-]+\.)+[\w-]+">
				</div>
				<div>
					Please note:  This form is only a statement of interest and not an application.
					An Enrollment Specialist will contact you to assist you with your application shortly.
					To apply directly please visit <a href="http://nyc.gov/prek" target="_blank">nyc.gov/prek</a> 
					from <span id="application-interval"></span>.
				</div>
				<input id="applyNow" type="button" value="Submit Info">
			</form>
			<div id="review">		
				<h3>Please review your submission:</h3>
				<div>
					<span class="name">Date of birth:</span><br><span id="review_dob"></span><br>
				</div>
				<div>
					<span class="name">Current address:</span><br><span id="review_house_number"></span> <span id="review_street_name"></span> <span id="review_apt"></span><br>
					<span id="review_borough"></span>, NY <span id="review_zip_code"></span>
				</div>
				<div><span class="name">Parent/Guardian name:</span><br><span id="review_parent_first_name"></span> <span id="review_parent_last_name"></span></div>
				<div><span class="name">Relationship:</span> <span id="review_relationship"></span></div>
				<div><span class="name">Day Telephone:</span> <span id="review_day_telephone"></span></div>
				<div><span class="name">Evening Telephone:</span> <span id="review_evening_telephone"></span></div>
				<div><span class="name">Email address:</span> <span id="review_email"></span></div>
				<div id="reviewBtns">
					<input type="button" onclick="$('#review').fadeOut();" value="Cancel">
					<input type="button" onclick="apply();" value="Submit">
				</div>
			</div>
			<div id="result">
				<div id="thanks">
					Thank you for completing our Pre-K for All information form!  
					Your submission is being sent to the Pre-K for All Outreach team, 
					who will contact you soon.   You will also receive an email shortly 
					confirming your submission.
				</div>				
				<input type="button" onclick="$('#result').fadeOut();" value="OK">			
			</div>
		</div>
	</div>
	<script>
		/* google analytics */
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		
		ga('create', 'UA-41281554-9', 'auto');
		ga('send', 'pageview');
	</script>	
</body>
</html>